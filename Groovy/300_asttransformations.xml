<section id="asttransformations">
== Compile-time meta programming and AST transformations</title>
	<section id="asttransformations1">
=== What are AST transformations?</title>
		<para>
			An
			<wordasword>Abstract Syntax Tree</wordasword>
			(AST)
			is a in memory representation of code as data. An ADT transformation
			allows to
			modify this representation during
			compile time. This is
			sometimes
			called
			compile-time metaprogramming.
		</para>
		<para>Groovy provides several AST transformations which allows you to
			reduce the amount of code you have to write.
		</para>
	</section>

	<section id="asttransformations_tupleConstructor">
=== @TupleConstructor</title>
		<para>
			If a class is annotated with
			`@TupleConstructor`
			Groovy generates a constructor using all fields.
		</para>
	</section>
	<section id="asttransformations_equals">
=== @EqualsAndHashCode</title>
		<para>
			The
			`@EqualsAndHashCode`
			annotation
			can be
			applied to a class, creates the
			`equals`
			and
			`hashCode`
			method. Includes fields can be customized.
		</para>
		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text"
					href="./examples/ast/TaskEqualsAndHashCode.groovy" />
			</programlisting>
		</para>

	</section>
	<section id="asttransformations_toString">
=== @ToString for beans</title>
		<para>
			The
			`@ToString`
			annotation
			can be
			applied to a class, generates a toString method,
			support
			boolean
			flags, like
			includePackage,
			includeNames, allows to
			exclude a
			list of
			fields.
		</para>
		<para>
			This annotation typically only considers properties (non-private
			fields) but you can include them via
			`@ToString(includeFields=true)`
			. Via
			`@ToString(excludes=list)`
			we can exclude a list of fields and properties.
		</para>

		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/ast/TaskToString.groovy" />
			</programlisting>
		</para>

	</section>
	<section id="asttransformations_canonical">
=== @Canonical </title>
		<para>Combines @ToString, @EqualsAndHashCode and
			@TupleConstructor.
		</para>
	</section>
	<section id="asttransformations_immutable">
=== @Immutable for immutable Java beans</title>
		<para>This annotation marks all fields in a class as final and ensure that there are no setters generate for the
			fields. It also creates a constructor for all fields, marks the class as final.
		</para>
	</section>

	<section id="asttransformations_delegate">
=== @Delegate</title>
		<para>@Delegate can be used on a field. All methods on the delegate are also available on the class with defines the
			delegate. If several delegates define the same method, it is recommended to override the method. If you do not
			override Groovy will use the first method it finds.
		</para>
	</section>
	<section id="asttransformations_sort">
=== @Sortable for beans</title>
		<para>
			You can automatically created a
			`Comparator`
			for a Groovy bean by annotating it with
			`@Sortable`
			. Fields are used in the order of declaration.
		</para>
		<para>You can also include/exclude fields.</para>
		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/ast/TaskSortable.groovy" />
			</programlisting>
		</para>
	</section>
	<section id="asttransformations_memoize">
=== @Memoize for methods</title>
		<para>
			If the
			`@Memoize`
			annotation is to a method the Groovy runtime caches the result for
			invocations with the same parameters. If the
			annotated method is
			called the first time with a certain set of parameter, it is executed
			and the result is cached. If
			the method is called again with the same
			parameters, the result is returned from the cache.
		</para>


		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/ast/MemoizedExample.groovy" />
			</programlisting>
		</para>

		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/ast/CallMemoizedExample.groovy" />
			</programlisting>
		</para>

	</section>
	<section id="asttransformations_annotationCollector">
=== @AnnotationCollector for combining AST Transformations
			annotations
		</title>
		<para>
			The
			`AnnotationCollector`
			allows to combine other AST Transformations annotations.
		</para>

		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/ast/Pojo.groovy" />
			</programlisting>
		</para>

		<para>You can use this annotation, it is also possible to override
			parameters in them.
		</para>
		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/ast/Person.groovy" />
			</programlisting>
		</para>

		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text"
					href="./examples/ast/TestPojoAnnotationCollector.groovy" />
			</programlisting>
		</para>
	</section>

	<section id="asttransformations_bindable">
=== @Bindable observable Properties</title>
		<para>
			The Java beans specification requires that Java beans support
			`PropertyChangeSupport`
			for all fields.
		</para>
		<para>
			The
			`@groovy.beans.Bindable`
			annotation can be applied to a whole class or a method. If the
			property is applied to a
			class, all methods will be
			treated as having
			the
			`@Bindable`
			annotation. This will trigger Groovy to generated
			a
			`java.beans.PropertyChangeSupport`
			property in the class and generate methods so that listeners can
			register and deregister. Also all setter methods
			will
			notfiy the
			property change listener.
		</para>
		<para>The following listing shows the Java version of a Java Bean with
			one property.
		</para>

	</section>

	<section id="asttransformations_builder">
=== @Builder</title>
		<para>
			The
			`@Builder`
			can be applied to a class and generates transparently a builder for
			this class.
		</para>

		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/ast/TaskWithBuilder.groovy" />
			</programlisting>
		</para>
		<para>
			<programlisting language="java">
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/ast/TestBuilder.groovy" />
			</programlisting>
		</para>
	</section>

	<section id="groovy_grapes">
=== @Grab for dependency management</title>
		<para>
			Groovy allows to add Maven dependencies to your Groovy script or
			Groovy class using the
			`@Grab`
			annotation. Before a Groovy program is executed it reads the
			`@Grab`
			annotation, resolves the Maven dependencies, downloads them and adds
			them to the classpath of the program.
		</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" parse="text" href="./examples/grap/grapexample.gradle" />
			</programlisting>
		</para>

		<para>
			Using the @GrabResolver annotation you can specify the Maven
			repository you want to use. For example
			`@GrabResolver(name='myrepo',
				root='http://myrepo.my-company.com/')
			`
			.
		</para>


	</section>
	<section id="asttransformations_others">
=== Other AST Transformations</title>
		<para>
			The following table lists other commonly used annotations in
			Groovy
			code:

			<table frame='all'>
		=== AST transformation annotations</title>
				<tgroup cols='2' align='left' colsep='1' rowsep='1'>
					<colspec colname='c1' colwidth="1*" />
					<colspec colname='c2' colwidth="2*" />
					<thead>
						<row>
							<entry>Annotation</entry>
							<entry>Description</entry>
						</row>
					</thead>
					<tbody>
						<row>
							<entry>@Singleton</entry>
							<entry>Makes annotated class a Singleton, access via
								ClassName.instance.
							</entry>
						</row>
						<row>
							<entry>@PackageScope</entry>
							<entry>
								Defines fields, methods or class as package scope, which
								is
								the default access modifier in Java.
							</entry>
						</row>
					</tbody>
				</tgroup>
			</table>
		</para>
	</section>
	<section id="asttransformations2">
=== Writing custom transformations</title>
		<para>You can also define you custom local or global transformations.
			For a local transformation you would write your
			own annotation and
			write a processors for that and use the annotation on an element in
			your Groovy class. The Groovy
			compiler calls your processors to
			transform the input into something else.
		</para>
		<para>Global transformations are applied to every single source unit
			in the
			compilation without the need for additional
			customization.
		</para>
	</section>
</section>